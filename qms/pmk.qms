#macro:pmk:SZ:DC:RG
  #var:rgd #range:0..2 #default:RG               // Радианы/Градусы/Грады
  #var:rDC #range:0..1000 #default:DC            // Количество десятичных знаков
  #var:eMD #range:0..2 #default:0                // Режим ввода
  #foreach:i:R;X;Y;Z;T;0..9;A..E                 // Регистры
     #var:r[$i]n #range:[-$SZ]..[$SZ] #default:0 // Числитель
     #var:r[$i]d #range:0..[$SZ] #default:1      // Знаменатель
  #end
  #foreach:i:A..D
    #var:r[$i] #range:0..[$SZ] #default:0
  #end
  #var rRR #range:0..100000000 #default:0
#end

//#global:debug:1
#macro:breakpoint
  #case:watch #return:S[$NN+1] #priority:10000
#end

#macro:debug
  #foreach:i:1..[$debug]
    #breakpoint
  #end
#end

#macro:eOn
    $eMD=1
#end

#macro:eOff
    $eMD=0
#end

#macro:up
    $rTn=$rZn
    $rTd=$rZd
    $rZn=$rYn
    $rZd=$rYd
    $rYn=$rXn
    $rYd=$rXd
#end

#macro:dn
    $rZn=$rTn
    $rZd=$rTd
    $rYn=$rZn
    $rYd=$rZd
#end

#macro:save
    $rRn=$rXn
    $rRd=$rXd
#end

#macro:A:N // Переход по адресу
  #site:S[$NN]
    #case:S[$N]
#end:NN

#macro:N:X // Ввод числа
  #site:S[$NN]
    #case:S[$NN]_1 {$eMD=0}
    #case:S[$NN]_2 {$eMD=1}
      $rXn=$rXn*10
    #case:S[$NN]_2 {$eMD=2}
      $rXn=0
  #site:S[$NN]_1
      #up
      $rXn=0
      $rXd=1
    #case:S[$NN]_2
  #site:S[$NN]_2
      #eOn
      $rXn=$rXn+[$X]
      #case:S[$NN+1]
#end:NN

#macro:C0B // /-/
  #site:S[$NN]
    #eOff
    $rXn=-$rXn
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C0D // Сх
  #site:S[$NN]
    #eOn
    $rXn=0
    $rXd=1
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C0E // ^
  #site:S[$NN]
    #up
    $eMD=2
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C0F // Вх
  #site:S[$NN]
    #eOff
    #up
    $rXn=$rRn
    $rXd=$rRd
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C10 // +
  #site:S[$NN]
    #eOff
    #save
    #case:S[$NN]_2 {$rXd=$rYd} #priority:10
    #case:S[$NN]_1 #priority:1
  #site:S[$NN]_1
    $rXn=$rXn*$rYd
    $rXd=$rXd*$rYd
    $rYn=$rYn*$rXd
    $rYd=$rYd*$rXd
    #case:S[$NN]_2
  #site:S[$NN]_2
    #dn
    $rXn=$rXn+$rYn
    #case:gcd #return:S[$NN]_3
  #site:S[$NN]_3
    #case:S[$NN]_5 #priority:1
    #case:S[$NN]_4 {$rA>1} #priority:10
  #site:S[$NN]_4
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:S[$NN]_5
  #site:S[$NN]_5
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C11 // -
  #site:S[$NN]
    #eOff
    #save
    $rXn=-$rXn
    #case:S[$NN]_2 {$rXd=$rYd} #priority:10
    #case:S[$NN]_1 #priority:1
  #site:S[$NN]_1
    $rXn=$rXn*$rYd
    $rXd=$rXd*$rYd
    $rYn=$rYn*$rXd
    $rYd=$rYd*$rXd
    #case:S[$NN]_2
  #site:S[$NN]_2
    #dn
    $rXn=$rXn+$rYn
    #case:gcd #return:S[$NN]_3
  #site:S[$NN]_3
    #case:S[$NN]_5 #priority:1
    #case:S[$NN]_4 {$rA>1} #priority:10
  #site:S[$NN]_4
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:S[$NN]_5
  #site:S[$NN]_5
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C12 // x
  #site:S[$NN]
    #eOff
    #dn
    #save
    $rXn=$rXn*$rYn
    $rXd=$rXd*$rYd
    #case:gcd #return:S[$NN]_1
  #site:S[$NN]_1
    #case:S[$NN]_3 #priority:1
    #case:S[$NN]_2 {$rA>1} #priority:10
  #site:S[$NN]_2
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:S[$NN]_3
  #site:S[$NN]_3
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C13 // /
  #site:S[$NN]
    #eOff
    #save
    #case:S[$NN]_1 {$rYn<0} #priority:10
    $rXn=-$rXn
    $rYn=-$rYn
    #case:S[$NN]_1 #priority:1
  #site:S[$NN]_2
    #dn
    $rXn=$rXd*$rYn
    $rXd=$rXn*$rYd
    #case:ERROR {$rXd=0} #priority:10
    #case:gcd #return:S[$NN]_2 #priority:1
  #site:S[$NN]_2
    #case:S[$NN]_4 #priority:1
    #case:S[$NN]_3 {$rA>1} #priority:10
  #site:S[$NN]_3
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:S[$NN]_4
  #site:S[$NN]_4
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C14 // XY
  #site:S[$NN]
    #eOff
    $rXn=$rYn
    $rXd=$rYd
    $rYn=$rXn
    $rYd=$rXd
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C20 // pi
  #site:S[$NN]
    #eOff
    #up
    #save
    $rXn=355
    $rXd=115
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C21 // sqrt
  #site:S[$NN]
    #eOff
    #save
    #case:ERROR {$rXn<0} #priority:10
    #case:S[$NN]_4 {$rXn=0} #priority:10
    #case:S[$NN]_4 {$rXn=1 and $rXd=1} #priority:10
    #case:sqrt #return:S[$NN]_1 #priority:1
  #site:S[$NN]_1
    #case:gcd #return:S[$NN]_2 #priority:1
  #site:S[$NN]_2
    #case:S[$NN]_4 #priority:1
    #case:S[$NN]_3 {$rA>1} #priority:10
  #site:S[$NN]_3
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:S[$NN]_4
  #site:S[$NN]_4
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C22 // x^2
  #site:S[$NN]
    #eOff
    #save
    $rXn=$rXn*$rXn
    $rXd=$rXd*$rXd
    #case:gcd #return:S[$NN]_1
  #site:S[$NN]_1
    #case:S[$NN]_3 #priority:1
    #case:S[$NN]_2 {$rA>1} #priority:10
  #site:S[$NN]_2
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:S[$NN]_3
  #site:S[$NN]_3
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C23 // 1/x
  #site:S[$NN]
    #eOff
    #save
    #case:ERROR {$rXn=0} #priority:10
    #case:S[$NN]_1 {$rXn<0} #priority:1
    #case:S[$NN]_2 {$rXn>0} #priority:1
  #site:S[$NN]_1
    $rXd=-$rXn
    $rXn=-$rXd
    #debug
    #case:S[$NN+1]
  #site:S[$NN]_2
    $rXd=$rXn
    $rXn=$rXd
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C25 // o
  #site:S[$NN]
    #eOff
    #dn
    $rXn=$rYn
    $rXd=$rYd
    $rTn=$rXn
    $rTd=$rXd
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C31 // |x|
  #site:S[$NN]
    #eOff
    #save
    #case:S[$NN]_1 {$rXn<0} #priority:10
    #case:S[$NN]_2 #priority:1
  #site:S[$NN]_1
    $rXn=-$rXn
    #case:S[$NN]_2
  #site:S[$NN]_2
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C32 // ЗН
  #site:S[$NN]
    #eOff
    #save
    $rXd=1
    #case:S[$NN]_1 {$rXn<0} #priority:10
    $rXn=-1
    #case:S[$NN]_1 {$rXn>0} #priority:10
    $rXn=1
    #case:S[$NN]_1 #priority:1
    $rXn=0
    #case:S[$NN]_1
  #site:S[$NN]_1
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C36 // max
  #site:S[$NN]
    #eOff
    #save
    #case:S[$NN]_1 {$rXn*$rYd<$rYn*$rXd} #priority:10
    #case:S[$NN]_1 #priority:1
    $rXn=$rYn
    $rXd=$rYd
    #case:S[$NN]_1
  #site:S[$NN]_1
    #debug
    #case:S[$NN+1]
#end:NN

#macro:C3B // СЧ
  #site:S[$NN]
    #eOff
    #save
    $rXn=1
    $rXd=[1..1000]
    #debug
    #case:S[$NN+1]
#end:NN

#foreach:r:0..9;A..E
  #macro:C4[$r] // Пr
    #site:S[$NN]
      #eOff
      $r[$r]n=$rXn
      $r[$r]d=$rXd
      #debug
      #case:S[$NN+1]
  #end:NN
#end

#macro:C50 // С/П
  #site:S[$NN]
    $rRR=$rRR*100+[$NN+1]
    #case:menu
#end:NN

#site:start
#foreach:r:0..105
  #case:S[$r] {$rRR mod 100 = [$r]}
  $rRR=$rRR div 100
#end

#macro:C51 // БП
  #site:S[$NN]
    #case:S[$NN+1]
#end:NN

#macro:C52 // В/О
  #site:S[$NN]
    #foreach:r:0..105
      #case:S[$r] {$rRR mod 100 = [$r]}
      $rRR=$rRR div 100
    #end
#end:NN

#macro:C53 // ПП
  #site:S[$NN]
    $rRR=$rRR*100+[$NN+2]
    #case:S[$NN+1]
#end:NN

#macro:C54 // НОП
  #site:S[$NN]
    #case:S[$NN+1]
#end:NN

#macro:C57 // F x<>0
  #site:S[$NN]
    #case:S[$NN+1] {$rXn=0} #priority:10
    #case:S[$NN+2] #priority:1
#end:NN

#macro:C59 // F x>=0
  #site:S[$NN]
    #case:S[$NN+1] {$rXn<0} #priority:10
    #case:S[$NN+2] #priority:1
#end:NN

#macro:C5C // F x<0
  #site:S[$NN]
    #case:S[$NN+2] {$rXn<0} #priority:10
    #case:S[$NN+1] #priority:1
#end:NN

#macro:C5E // F x=0
  #site:S[$NN]
    #case:S[$NN+2] {$rXn=0} #priority:10
    #case:S[$NN+1] #priority:1
#end:NN

#foreach:r:0..9;A..E
  #macro:C6[$r] // ИПr
    #site:S[$NN]
      #eOff
      #up
      $rXn=$r[$r]n
      $rXd=$r[$r]d
      #debug
      #case:S[$NN+1]
  #end:NN
#end

#site:gcd // НОД
#case:gcd_1 #priority:1 {$rXn>0}
$rA=$rXn
$rB=$rXd
#case:gcd_1 #priority:1 {$rXn<0}
$rA=-$rXn
$rB=$rXd
#case:gcd_3 #priority:10 {$rXn=0}

#site:gcd_1
#case:gcd_2 {$rA<$rB}
$rB=$rB mod $rA
#case:gcd_2 {$rA>$rB}
$rA=$rA mod $rB
#case:gcd_3 {$rA=$rB}
#case:gcd_3 {$rA=0}
$rB=$rA
#case:gcd_3 {$rB=0}
$rA=$rB

#site:gcd_2
#case:gcd_1

#site:gcd_3
#return

#site:sqrt
$rA=$rXn div $rXd
$rB=1
$rC=0
#case:sqrt_1

#site:sqrt_1
#case:sqrt_2 {$rA>=$rB}
$rA=$rA-$rB
$rB=$rB+2
$rC=$rC+1
#case:sqrt_3 {$rA<$rB}
$rXn=$rC
$rXd=1

#site:sqrt_2
#case:sqrt_1

#site:sqrt_3
$rC=$rXn
$rD=$rXd
$rXn=$rXn*$rRd*$rXn+$rRn*$rXd*$rXd
$rXd=$rXd*$rXn*$rRd*2
#case:gcd #return:sqrt_4

#site:sqrt_4
#case:sqrt_5 {$rA>1}
#case:sqrt_6 {$rA<2}

#site:sqrt_5
$rXn=$rXn div $rA
$rXd=$rXd div $rA
#case:sqrt_6

#site:sqrt_6
#case:sqrt_7 {$rC*$rXd<$rXn*$rD}
$rC=$rXn*$rD-$rC*$rXd
$rD=$rXd*$rD
#case:sqrt_7 {$rA*$rXd>=$rXn*$rB}
$rC=$rC*$rXd-$rXn*$rD
$rD=$rXd*$rD

#site:sqrt_7
#case:sqrt_8 {$rC*$rDC<$rD} #priority:10
#case:sqrt_3 #priority:1

#site:sqrt_8
#return

#site:ERROR #lose
#page:1
ЕГГОГ
#case:watch 'Далее...'

#site:watch
#page:1
^T =$rTn/$rTd #t:20 0=$r0n/$r0d^
^Z =$rZn/$rZd #t:20 0=$r1n/$r1d^
^Y =$rYn/$rYd #t:20 0=$r2n/$r2d^
^X =$rXn/$rXd #t:20 0=$r3n/$r3d^
^X1=$rRn/$rRd #t:20 0=$r4n/$r4d^
^#t:20 0=$r5n/$r5d^
^#t:20 0=$r6n/$r6d^
^#t:20 0=$r7n/$r7d^
^#t:20 0=$r8n/$r8d^
^#t:20 0=$r9n/$r9d^
^#t:20 0=$rAn/$rAd^
^#t:20 0=$rBn/$rBd^
^#t:20 0=$rCn/$rCd^
^RR={$rRR div 1000000}:{($rRR div 10000) mod 100}:{($rRR div 100) mod 100}:{$rRR mod 100}#t:20 0=$rDn/$rDd^
^NN={$RRR mod 1000} #t:20 0=$rEn/$rEd^
#case:watch_1 'Далее...'

#site:watch_1
#return

#var:rA #range:0..99999999 #default:0 #hide
#var:rB #range:0..99999999 #default:0 #hide
#var:rC #range:0..99999999 #default:0 #hide
#var:rD #range:0..99999999 #default:0 #hide
#var:rX #range:0..99999999 #default:0 #hide
#var:rY #range:0..99999999 #default:0 #hide
#var:rZ #range:0..99999999 #default:0 #hide

#macro:cell:A:B:DF
  #var:cl[$A][$B] #range:0..99 #default:[$DF] #mod:10 #hide
    #field:H
      #text:0..0 ' '
      #text:1..1 '1'
      #text:2..2 '2'
      #text:3..3 '3'
      #text:4..4 '4'
      #text:5..5 '5'
      #text:6..6 '6'
      #text:7..7 '7'
      #text:8..8 '8'
      #text:9..9 '.'
    #field:L
      #text:0..0 '  '
      #text:1..1 ' 1'
      #text:2..2 ' 2'
      #text:3..3 ' 3'
      #text:4..4 ' 4'
      #text:5..5 ' 5'
      #text:6..6 ' 6'
      #text:7..7 ' 7'
      #text:8..8 ' 8'
      #text:9..9 ' .'
#end

#for:y:0..6
  #for:x:0..3
    #cell:[$y]:[$x]:99
  #end
#end

#for:ix:0..2
  #var:mn[$ix] #range:0..99999999 #default:0 #mod:100 #hide
    #field:3
    #field:2
    #field:1
    #field:0
#end

#macro:aim
#page:1
^+-----------------+^
^| @cl00 @cl01 @cl02 @cl03 |^
^| @cl10 @cl11 @cl12 @cl13 |^
^| @cl20 @cl21 @cl22 @cl23 |^
^| @cl30 @cl31 @cl32 @cl33 |^
^| @cl40 @cl41 @cl42 @cl43 |^
^| @cl50 @cl51 @cl52 @cl53 |^
^| @cl60 @cl61 @cl62 @cl63 |^
^+-----------------+^
#end

#site:entry #default
#page:1
...
#case:init 'Старт'

// Расстановка мин
#site:init
#case:setup #return:init_1
#site:init_1
$mn0=$rA
#case:setup #return:init_2
#site:init_2
$mn1=$rA
#case:setup #return:init_3
#site:init_3
$mn2=$rA
#case:init_4
$rX=0
$rY=6

// Просмотр третьей линии
#site:init_4
#case:calc #return:init_5
#site:init_5
#case:update #return:init_6
#site:init_6
$rX=$rX+1
#case:init_4 {$rX<8}
#case:init_7 {$rX>=8}

// Определение допустимых ходов
#site:init_7
// TODO:

// Обновление AIM (X, Y, A)
#site:update
// TODO:
#return

// Подсчёт количества мин на соседних клетках (X, Y) -> A; B, C, Z, D 
#site:calc
$rC=0
$rA=0
#case:calc_1
#site:calc_1
#case:calc_2 {$rC=0}
$rZ=$mn0
#case:calc_2 {$rC=1}
$rZ=$mn1
#case:calc_5 {$rC>1}
#site:calc_2
$rB=$rY*10+$rX
$rD=$rZ mod 100
#case:calc_5 {$rB=$rD}
$rA=1000 // Boom
#case:calc_3 {$rB=$rD+1 or $rB=$rD-1 or $rB=$rD+10 or $rB=$rD-10 or $rB=$rD+11 or $rB=$rD-11 or $rB=$rD+9 or $rB=$rD-9}
$rA=$rA+1
#case:calc_3 {$rB<>$rD and $rB<>$rD+1 and $rB<>$rD-1 and $rB<>$rD+10 and $rB<>$rD-10 and $rB<>$rD+11 and $rB<>$rD-11 and $rB<>$rD+9 and $rB<>$rD-9}
#site:calc_3
$rZ=$rZ div 100
#case:calc_2 {$rZ>0}
#case:calc_4 {$rZ=0}
#site:calc_4
$rC=$rC+1
#case:calc_1 {$rC<=1}
#case:calc_5 {$rC>1}
#site:calc_5
#return

// Расстановка 4 мин () -> A; C, X
#site:setup
$rA=0
$rC=0
#case:setup_1
#site:setup_1
$rX=<0..5>*10+<0..7>
#case:check #return:setup_2
#site:setup_2
#case:setup_1 {$rX=0}
#case:setup_3 {$rX>0}
#site:setup_3
$rA=$rA*100+$rX
$rC=$rC+1
#case:setup_1 {$rC<4}
#case:setup_4 {$rC>=4}
#site:setup_4
#return

// Проверка отсутствия повторений (X) -> X
#site:check
#case:check_1 {$mn0.0<>$rX and $mn0.1<>$rX and $mn0.2<>$rX and $mn0.3<>$rX}
#case:check_2 {$mn0.0=$rX}
#case:check_2 {$mn0.1=$rX}
#case:check_2 {$mn0.2=$rX}
#case:check_2 {$mn0.3=$rX}
#site:check_1
#case:check_3 {$mn1.0<>$rX and $mn1.1<>$rX and $mn1.2<>$rX and $mn1.3<>$rX}
#case:check_2 {$mn1.0=$rX}
#case:check_2 {$mn1.1=$rX}
#case:check_2 {$mn1.2=$rX}
#case:check_2 {$mn1.3=$rX}
#site:check_2
$rX=0
#case:check_2
#site:check_3
#return

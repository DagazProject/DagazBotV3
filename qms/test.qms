#global:DC:100

#var:rXn #range:-100000000..100000000 #default:0
#var:rXd #range:-100000000..100000000 #default:0
#var:rYn #range:-100000000..100000000 #default:0
#var:rYd #range:-100000000..100000000 #default:0
#var:rZn #range:-100000000..100000000 #default:0
#var:rZd #range:-100000000..100000000 #default:0
#var:rTn #range:-100000000..100000000 #default:0
#var:rTd #range:-100000000..100000000 #default:0
#var:rRn #range:-100000000..100000000 #default:0
#var:rRd #range:-100000000..100000000 #default:0
#var:rA  #range:0..100000000 #default:0
#var:rB  #range:0..100000000 #default:0
#var:rC  #range:0..100000000 #default:0
#var:rD  #range:0..100000000 #default:0
#var:eMD #range:0..2 #default:0

#macro:eOn
    $eMD=1
#end

#macro:eOff
    $eMD=0
#end

#macro:up
    $rTn=$rZn
    $rTd=$rZd
    $rZn=$rYn
    $rZd=$rYd
    $rYn=$rXn
    $rYd=$rXd
#end

#macro:dn
    $rZn=$rTn
    $rZd=$rTd
    $rYn=$rZn
    $rYd=$rZd
#end

#macro:save
    $rRn=$rXn
    $rRd=$rXd
#end

#macro:N:X // Ввод числа
  #site:[$S][$NN]
    #case:[$S][$NN]_1 {$eMD=0}
    #case:[$S][$NN]_2 {$eMD=1}
      $rXn=$rXn*10
    #case:[$S][$NN]_2 {$eMD=2}
      $rXn=0
  #site:[$S][$NN]_1
      #up
      $rXn=0
      $rXd=1
    #case:[$S][$NN]_2
  #site:[$S][$NN]_2
      #eOn
      $rXn=$rXn+[$X]
      #case:[$S][$NN+1]
#end:NN

#macro:C0E // ^
  #site:[$S][$NN]
    #up
    $eMD=2
    #debug
    #case:[$S][$NN+1]
#end:NN

#macro:C10 // +
  #site:[$S][$NN]
    #eOff
    #save
    #case:[$S][$NN]_2 {$rXd=$rYd} #priority:10
    #case:[$S][$NN]_1 #priority:1
  #site:[$S][$NN]_1
    $rXn=$rXn*$rYd
    $rXd=$rXd*$rYd
    $rYn=$rYn*$rXd
    $rYd=$rYd*$rXd
    #case:[$S][$NN]_2
  #site:[$S][$NN]_2
    #dn
    $rXn=$rXn+$rYn
    #case:gcd #return:[$S][$NN]_3
  #site:[$S][$NN]_3
    #case:[$S][$NN]_5 #priority:1
    #case:[$S][$NN]_4 {$rA>1} #priority:10
  #site:[$S][$NN]_4
    $rXn=$rXn div $rA
    $rXd=$rXd div $rA
    #case:[$S][$NN]_5
  #site:[$S][$NN]_5
    #debug
    #case:[$S][$NN+1]
#end:NN

#macro:C50 // С/П
  #site:[$S][$NN]
    $rRR=$rRR*100+[$NN+1]
    #case:menu
#end:NN

#N:2  // 01 2
#C0E  // 02 ^
#N:2  // 03 2
#C10  // 04 +
#C50  // 05 С/П

#site:sin
#case:sin_1 #priority:10 {$rXn>360*$rXd}
$rXn=$rXn-360*$rXd
#case:sin_1 #priority:10 {$rXn<0}
$rXn=$rXn+360*$rXd
#case:sin_2 #priority:1

#site:sin_1
#case:sin

#site:sin_2
#case:sin_3 #priority:10 {$rXn>180*$rXd}
$rXn=$rXn-180*$rXd
$rC=-1
#case:sin_3 #priority:1
$rC=1

#site:sin_3
$rXn=(180*$rXd-$rXn)*$rXn
$rXd=$rXd*$rXd
#case:sin_4

#site:sin_4
$rA=40500*$rXd-$rXn
$rB=$rXd
$rXn=$rXn*4
#case:sin_5

#site:sin_5
$rXn=$rXn*$rB*$rC
$rXd=$rXd*$rA
#case:sin_6

#site:sin_6
#case:gcd #return:sin_7

#site:sin_7
#case:sin_8 {$rA>1}
#case:sin_9 {$rA<2}

#site:sin_8
$rXn=$rXn div $rA
$rXd=$rXd div $rA
#case:sin_9

#site:sin_9
#return

#site:sqrt
$rA=$rXn div $rXd
$rB=1
$rC=0
#case:sqrt_1
#site:sqrt_1
#case:sqrt_2 {$rA>=$rB}
$rA=$rA-$rB
$rB=$rB+2
$rC=$rC+1
#case:sqrt_3 {$rA<$rB}
$rXn=$rC
$rXd=1
#site:sqrt_2
#case:sqrt_1
#site:sqrt_3
$rXn=$rXn*$rRd*$rXn+$rRn*$rXd*$rXd
$rXd=$rXd*$rXn*$rRd*2
#case:gcd #return:sqrt_4
#site:sqrt_4
#case:sqrt_5 {$rA>1}
#case:sqrt_6 {$rA<2}
#site:sqrt_5
$rXn=$rXn div $rA
$rXd=$rXd div $rA
#case:sqrt_6
#site:sqrt_6
#return

#site:gcd // НОД
#case:gcd_1 #priority:1 {$rXn>0}
$rA=$rXn
$rB=$rXd
#case:gcd_1 #priority:1 {$rXn<0}
$rA=-$rXn
$rB=$rXd
#case:gcd_3 #priority:10 {$rXn=0}
#site:gcd_1
#case:gcd_2 {$rA<$rB} #priority:1
$rB=$rB mod $rA
#case:gcd_2 {$rA>$rB} #priority:1
$rA=$rA mod $rB
#case:gcd_3 {$rA=$rB} #priority:10
#case:gcd_3 {$rA=0} #priority:10
$rA=$rB
#case:gcd_3 {$rB=0} #priority:10
$rB=$rA
#site:gcd_2
#case:gcd_1
#site:gcd_3
#return

#site:test #default
#page:1
2 + 2 = ?
#case:S0 'Старт'

#site:menu #win
#page:1
rXn = $rXn
rXd = $rXd
